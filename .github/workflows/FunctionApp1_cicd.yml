name: FunctionApp1 cicd

on:
  workflow_dispatch:
  push:
    paths:
    - FunctionApp1/**
    branches:  
      - 'dev'
      - 'test'
      - 'main'
  pull_request:
    types: [opened, reopened]
    paths:
    - FunctionApp1/**
    branches:  
      - 'dev'
      - 'test'
      - 'main'

env:
  funcname: FunctionApp1      

jobs:
  build:
    uses: ./.github/workflows/template_ci.yml
    with:
      runs-on: windows-latest
      function-name: ${{ env.funcname }}
  deploydev:
    if: (github.ref == 'refs/heads/dev' && github.event_name == 'push')
    uses: ./.github/workflows/template_${{ env.funcname }}cd.yml
    with:
      runs-on: windows-latest
      env: DEV
      kvname: kvabdev
    secrets: inherit
    needs: build
  deploytest:
    if: (github.ref == 'refs/heads/test' && github.event_name == 'push')
    uses: ./.github/workflows/template_${{ env.funcname }}cd.yml
    with:
      runs-on: windows-latest
      env: TEST
      kvname: kvabdev
    secrets: inherit
    needs: build
  deployprod:
    if: (github.ref == 'refs/heads/main' && github.event_name == 'push')
    uses: ./.github/workflows/template_${{ env.funcname }}cd.yml
    with:
      runs-on: windows-latest
      env: PROD
      kvname: kvabdev
    secrets: inherit
    needs: build